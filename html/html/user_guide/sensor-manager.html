

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Sensor Manager &mdash; mF2C 1.0 (2018-03-21) documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> mF2C
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mF2C/docs/index.html">New</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">mF2C</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Sensor Manager</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/user_guide/sensor-manager.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sensor-manager">
<h1>Sensor Manager<a class="headerlink" href="#sensor-manager" title="Permalink to this headline">¶</a></h1>
<p>The mF2C Sensor Manager provides the ability for applications to subscribe to sensor data.
Multiple applications can subscribe to data from the same sensor, as this provides an
abstraction over the actual hardware interaction with <em>sensor drivers</em> and only requires
a subscription to a stream of values.</p>
<p>Drivers are automatically spawned according to the sensors idenfified by resource
categorisation and present in <cite>device-dynamic</cite>. The mapping between sensor hardware
and sensor drivers is defined in the sensor manager repository.</p>
<div class="section" id="creating-and-building-a-sensor-driver">
<h2>Creating and building a sensor driver<a class="headerlink" href="#creating-and-building-a-sensor-driver" title="Permalink to this headline">¶</a></h2>
<p>Sensor drivers are distributed as Docker images that read sensor data and publish it back
to the sensor manager. The interface is language-agnostic. An example sensor driver written
in golang is included in the sensor driver repository and published as a Docker image.</p>
<p>The following environment variables are passed to the sensor driver application:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">SENSOR_MANAGER_HOST</span><span class="o">=</span>&lt;host&gt;
<span class="nv">SENSOR_MANAGER_PORT</span><span class="o">=</span>&lt;port&gt;
<span class="nv">SENSOR_MANAGER_PATH_SUFFIX</span><span class="o">=[</span>path suffix<span class="o">]</span>
<span class="nv">SENSOR_MANAGER_USERNAME</span><span class="o">=</span>&lt;username&gt;
<span class="nv">SENSOR_MANAGER_PASSWORD</span><span class="o">=</span>&lt;password&gt;
<span class="nv">SENSOR_MANAGER_TOPIC</span><span class="o">=</span>&lt;topic&gt;
<span class="nv">SENSOR_CONNECTION_INFO</span><span class="o">=</span>&lt;json&gt;
</pre></div>
</div>
<p><cite>SENSOR_MANAGER_HOST</cite> and <cite>_PORT</cite> define the location of the endpoint the sensor manager
is listening for values at. The endpoint is a WebSocket-based MQTT server. It may be running
behind a reverse proxy which rewrites its address, so <cite>_PATH_SUFFIX</cite> is provided, or is empty,
for any changes to the HTTP URL path, applied as a suffix.</p>
<p><cite>_USERNAME</cite> and <cite>_PASSWORD</cite> are MQTT connection credentials for your sensor driver. Publish
values to the topic specified in <cite>_TOPIC</cite>. Any custom physical sensor connection information
is available as a JSON object in <cite>SENSOR_CONNECTION_INFO</cite>.</p>
<p>Outgoing values must be JSON objects conforming to the following schema:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;SensorId&quot;</span><span class="p">:</span>   <span class="s2">&quot;string, an ID that differentiates this piece of hardware sensor from others&quot;</span><span class="p">,</span>
    <span class="nt">&quot;SensorType&quot;</span><span class="p">:</span> <span class="s2">&quot;string, the type of the sensor (hardware)&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Quantity&quot;</span><span class="p">:</span>   <span class="s2">&quot;string, the SI dimension, e.g. humidity&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Timestamp&quot;</span><span class="p">:</span>  <span class="s2">&quot;string, RFC 3339, when the measurement was taken&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Value&quot;</span><span class="p">:</span>      <span class="s2">&quot;float, the measurement value&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Unit&quot;</span><span class="p">:</span>       <span class="s2">&quot;string, the SI base unit of the value&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The resulting application must be packaged as a Docker image accessible to the machine on
which it will be deployed.</p>
<p>As a final step, add the sensor driver information to <cite>sensor-container-map.json</cite> present in
the sensor manager repository.</p>
</div>
<div class="section" id="deploying-the-sensor-manager">
<h2>Deploying the sensor manager<a class="headerlink" href="#deploying-the-sensor-manager" title="Permalink to this headline">¶</a></h2>
<p>Sensor manager and related images are hosted on Docker Hub under:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>mf2c/sensor-manager</cite></p></li>
<li><p><cite>mf2c/sensor-manager-mosquitto</cite></p></li>
<li><p><cite>mf2c/sensor-manager-example-driver</cite></p></li>
<li><p><cite>mf2c/sensor-manager-example-application</cite></p></li>
</ul>
</div></blockquote>
<p>The sensor manager repository includes a script (<cite>deploy-mf2c.sh</cite>) that deploys the sensor manager
onto mF2C as an optional add-on.</p>
<p>Usage: <cite>sh deploy-mf2c.sh &lt;mf2c-ip&gt;</cite></p>
<p>Component configuration is customisable and described in the repository’s <cite>docker-compose.yml</cite>.</p>
</div>
<div class="section" id="reading-sensor-values">
<h2>Reading sensor values<a class="headerlink" href="#reading-sensor-values" title="Permalink to this headline">¶</a></h2>
<p>A client application reads sensor data by subscribing to an MQTT topic with credentials obtained
from the sensor manager’s API. An example application written in golang is included in the
sensor-manager repository.</p>
<p>There is only one external API endpoint: <cite>/topics</cite>. Hosted behind the default reverse proxy,
this is translated to <cite>/sensor-manager/api/topics</cite>. This endpoint returns a JSON list of topics
that are currently served by the sensor manager.</p>
<p>The client application connects to the sensor manager’s WebSocket-based MQTT server on the
corresponding topic with the specified credentials and begins reading the data. By default, the
server is behind a reverse proxy and its path changed to <cite>/sensor-manager/stream/</cite>.</p>
<p>Values returned by the stream are in the following format:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;Timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;string, RFC 3339, when the measurement was taken&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Value&quot;</span><span class="p">:</span>     <span class="s2">&quot;float, the measurement value&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Unit&quot;</span><span class="p">:</span>      <span class="s2">&quot;string, the SI base unit of the value&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, mF2C

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>