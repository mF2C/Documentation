

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CAU-Client &mdash; mF2C 1.0 (2018-03-21) documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> mF2C
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">New</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">mF2C</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>CAU-Client</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/mF2C/docs/cau_client.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cau-client">
<h1>CAU-Client<a class="headerlink" href="#cau-client" title="Permalink to this headline">¶</a></h1>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This application supports the agent registration and other security processes like the creation/extraction/validation of message and identity tokens.  The CAU client is an internal block of an Agent and is deployed as part of the Agent.  It communicates with the other Agent blocks over private Docker network and with the external CAU middleware via HTTPs.</p>
</div>
<div class="section" id="usage">
<h2>Usage:<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="api">
<h3>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h3>
<p>The CAU-client runs a TCP server at <host>:46065</p>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>The CAU-client offers two functions:</p>
<ul class="simple">
<li><p>get Agent certificate - during the Agent initialisation phase, the Policy block (in a full Agent) or the initialisation script (in a micro Agent) uses this function to obtain an Agent certificate from the mF2C Trusted CA service.  The function takes in three arguments:</p>
<ul>
<li><p>the new Agent’s device ID,</p></li>
<li><p>the detected Leader’s device ID and</p></li>
<li><p>the ID Key of the human owner of the device hosting the new Agent.</p></li>
</ul>
</li>
</ul>
<p>Here is an example request message which needs to be UTF-8 encoded and terminates with a \n:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">detectedLeaderID</span><span class="o">=</span><span class="mi">0</span><span class="n">f848d8fb78cbe5615507ef5a198f660ac89a3ae03b95e79d4ebfb3466c20d54e9a5d9b9c41f88c782d1f67b32231d31b4fada8d2f9dd31a4d884681b784ec5a</span><span class="p">,</span><span class="n">deviceID</span><span class="o">=</span><span class="n">c6968d75a7df20e2d2f81f87fe69bf0b7dd14f4a22cca5f15ffc645cb4d45944bfdc7a7a970a9e13a331161e304a3094d8e6e362e88bd7df0d7b5473b6d2aa80</span><span class="p">,</span><span class="n">IDkey</span><span class="o">=</span><span class="mi">12345</span>
</pre></div>
</div>
<p>The CAU-Client generates an RSA keypair (2048 length) and uses it to build a Certificate Signing Request (CSR) which it sends to the CAU together with the three arguments.  The CAU first validates the IDKey against the mF2C Cloud CIMI instance before getting the CA to sign the CSR.  The CAU-Client, on receiving the signed certificate, stores this locally within the Agent before returning an ‘OK’ message to the caller.  The Agent certificate is used by other Agent blocks as a credential, e.g. as the server certificate by Traefik, for SSL handshake by the VPN-client.</p>
<ul>
<li><p>get Agent public key - The public key associated with the Agent’s certificate is used by the <a class="reference external" href="https://github.com/mF2C/aclib">ACLib</a> block to implement policy based data security and to create/validate identity token for authenticating an Agent’s identity.  The function takes in an Agent’s device ID which the CAU-Client sends to the CAU middleware to get the associated public key.  Here is an example request message which needs to be UTF-8 encoded and terminates with an \n:</p>
<p>getpubkey=3b95e79d4ebfb3466c20d54e5615507ef5a198f660ac89a3ae03b95e79d4ebfb3466c20d54e9a5d9b9c41f88c782d1f67b32231d31b4fada8d2f9dd31a4d8846df0d7b5473b6d2aa80</p>
</li>
</ul>
<p>The retrieved public key is in PEM format and here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-----</span><span class="n">BEGIN</span> <span class="n">RSA</span> <span class="n">PUBLIC</span> <span class="n">KEY</span><span class="o">-----</span>
<span class="n">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAre9dOvFbyVqX5zDNxsn5</span>
<span class="n">XYWI4FTXlGjWEViqN41HDYK7f41VibuRYYWqjdUqKsSmNFJaIw05ZI7l7</span><span class="o">/</span><span class="n">aXp</span><span class="o">/</span><span class="mi">6</span><span class="n">A</span>
<span class="n">iDfd9xiO6e4tMaF4H0BczDtRUUzFgReCqkkZjOQSDTbuqSOoT4JqOaE3S9npfY2S</span>
<span class="n">x45</span><span class="o">/</span><span class="n">LaRNVCQaycgCKve</span><span class="o">/</span><span class="n">A</span><span class="o">/</span><span class="n">ajeq9boFu</span><span class="o">/</span><span class="n">bPLhzHdrSiO</span><span class="o">+</span><span class="n">CsY094p5219Km99wpfXq</span>
<span class="n">J8JS</span><span class="o">/</span><span class="n">AelU9zpsNbbWzt9OV9Xi6tTnL6CwDhp5JS3d4K0rwzA6JFlqyWQAC1bTGUf</span>
<span class="n">nC43tDAacp8h31xsx1ux1CQfm6ADK6dg6vdVd8C9</span><span class="o">+</span><span class="n">OJof0x</span><span class="o">/</span><span class="mi">05</span><span class="n">gI0zhX4oeuv</span><span class="o">+</span><span class="n">Aw</span>
<span class="n">tQIDAQAB</span>
<span class="o">-----</span><span class="n">END</span> <span class="n">RSA</span> <span class="n">PUBLIC</span> <span class="n">KEY</span><span class="o">-----</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-run">
<h2>How to run:<a class="headerlink" href="#how-to-run" title="Permalink to this headline">¶</a></h2>
<p>For the IT2 demo, the CAU-client socket server runs on port 46065.  Both the Cloud CAU and local CAU ip:port are expected to be passed in as application arguments on launching the application. The agent’s private key and X509 certificate are written to the shared file volume pkidata.  Both Traefik and VPN-Client will pick up the credentials and use the certificate for SSL.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">java</span> <span class="o">-</span><span class="n">jar</span> <span class="n">cau</span><span class="o">-</span><span class="n">client</span><span class="o">.</span><span class="n">jar</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">46400</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">46410</span> 
</pre></div>
</div>
<p>The CAU client is bundled with the Fog and Untrusted CA certificates which are used as appropriate in the certificate path for the newly signed certificates.  The Fog CA issues certificates to mF2C components like the CAU and the Untrusted CA issues certificates to mF2C Agents.</p>
<div class="section" id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h3>
<p>Make sure you send a EOL signal, e.g. ‘\n’ to the server to indicates end of transmission.</p>
</div>
</div>
<div class="section" id="changelog">
<h2>CHANGELOG<a class="headerlink" href="#changelog" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>2.0 (29/07/2019)<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Rewritten from IT1 version.  CAU-Client now runs a TCP-server to listen to requests from other blocks in the Agent.</p>
<div class="section" id="added">
<h4>Added<a class="headerlink" href="#added" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>The get public key function to support ACLib operations.</p></li>
</ul>
</div>
<div class="section" id="changed">
<h4>Changed<a class="headerlink" href="#changed" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>The get certificate function now takes in 3 arguments: deviceID, detectedLeaderID, IDkey.</p></li>
<li><p>The Agent’s device ID, signed certificate and private key is written to /pkidata</p></li>
</ul>
</div>
</div>
<div class="section" id="id2">
<h3>2.1 (28/08/2019)<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id3">
<h4>Changed<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>removed the IDKey parameter for the get cert operation.  Identification block validates this IDKey upstream.</p></li>
<li><p>removed commented out redundant code</p></li>
<li><p>updated code comments for Javadoc</p></li>
</ul>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, mF2C

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>